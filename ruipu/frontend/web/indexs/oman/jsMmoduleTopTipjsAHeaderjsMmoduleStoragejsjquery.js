M.define("TopTip",function(b,a,c){c.exports={show:function(d){var d=$('<div id="over_container"><div id="over_message">'+d+"</div></div>").appendTo("body");setTimeout(function(){d.hide("fast",function(){d.remove()})},3000)}}});M.closure(function(m){var G=$("#header");if(!G.length){return false}var A=m("/js/Dropdown");var y=m("/js/SiteSearch"),j=new y({input:"_j_head_search_input",submit:"_j_head_search_link"});var c=$("#_j_head_search_input");c.on("keydown",function(L){if(L.keyCode==13){var J=$.trim(c.val());if(J){var K=encodeURIComponent(J);location.href="/group/s.php?q="+K}}});var b=$("#head-btn-daka"),z=$("#head-my-coin");m("jq-upnum");$(function(){$(".new_daka_tips").addClass("on")});$(".ndt_close").on("click",function(){$(this).parent().hide()});M.Event.on("afterDaka",D);function D(J){if(J&&J.dakaFlag){b.closest(".head-daka").addClass("daka-complete")}}var e=l("dakaday");if(e!=null){$(".head-btn-daka").attr("data-day",e)}function l(J){var K=new RegExp("(^|&)"+J+"=([^&]*)(&|$)");var L=window.location.search.substr(1).match(K);if(L!=null){return unescape(L[2])}return null}var I=new A({nav:"#_j_head_user",panel:"#_j_user_panel",showCallback:function(J,K){J.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(J,K){J.find(".drop-trigger").removeClass("drop-trigger-active")},delay:500});var k=0,d=$("#_j_head_msg"),f=$("#_j_msg_panel"),C=d.find(".head-msg-new"),h=$("#_j_msg_float_panel");var i=new A({nav:d.selector,panel:f.selector,showCallback:function(J,K){J.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(J,K){J.find(".drop-trigger").removeClass("drop-trigger-active")},delay:200});M.Event.on("get new msg",function(J){if(J.msg||k>0){f.find("ul").html(J.menu_index);E()}});f.on("click","a",function(J){M.Event.fire("update msg")});h.on("click","ul a",function(J){M.Event.fire("update msg")});h.on("click",".close-newmsg",function(J){x()});function x(){C.hide();h.hide();$.ajax({url:"http://"+Env.WWW_HOST+"/ajax/ajax_msg.php",dataType:"jsonp",data:{a:"ignore",from:"1"},success:function(J){M.Event.fire("update msg")}})}window.close_msg_tips=x;function E(){var J="";k=0;f.find(".num").each(function(K,N){var L=$(N);k+=Number(L.html());J+="<li>"+L.closest("li").html()+"</li>"});if(k>0){C.html((k>99?"99+":k)).show();h.find("ul").html(J).end().show()}else{C.hide();h.hide()}}E();$("#_j_nav_sales").find("[data-sales-nav]").on("click",function(){var J=$(this).data("salesNav");mfwPageEvent("sales","index_sales_nav",{name:J})});var g=0,B=0;$("._j_sales_nav_show").hover(function(){clearTimeout(g);B=setTimeout(function(){$("._j_sales_nav_show").addClass("head-nav-hover");$("._j_sales_top").fadeIn(300)},200)},function(){clearTimeout(B);g=setTimeout(function(){$("._j_sales_nav_show").removeClass("head-nav-hover");$("._j_sales_top").fadeOut(300)},200)});var w=0,q=0;$("._j_shequ_nav_show").hover(function(){clearTimeout(w);q=setTimeout(function(){$("._j_shequ_nav_show").addClass("head-nav-hover");$("._j_shequ_top").fadeIn(300)},200)},function(){clearTimeout(q);w=setTimeout(function(){$("._j_shequ_nav_show").removeClass("head-nav-hover");$("._j_shequ_top").fadeOut(300)},200)});var F=$("#_j_community_panel"),s=F.find(".panel-image").length,t=Math.floor(Math.random()*s);if(t===s){t--}F.find(".panel-image").eq(t).show();$("#_j_showlogin").click(function(J){if(window.location.host===Env.WWW_HOST){J.preventDefault()}M.Event.fire("login:required")});var p=window.location.hostname,u=window.location.pathname+window.location.search,a=$("#_j_head_nav");if(p.indexOf("www")===0){if(u===""||u==="/"){a.children("li:eq(0)").addClass("head-nav-active")}var r=new RegExp("^/(mdd|photo/mdd|poi|photo/poi|travel-scenic-spot|jd|cy|gw|yl|yj|xc)/|sFrom=mdd.*|sFrom=smdd.*","i");if(r.test(u)){a.children("li:eq(1)").addClass("head-nav-active")}var o=new RegExp("^/gonglve/.*","i");if(o.test(u)){a.children("li:eq(2)").addClass("head-nav-active")}var n=window.Env&&window.Env.sales_title_tag;if(n){if(n==="flight_hotel"){a.children("li:eq(3)").find("ul>li:eq(0)>a").addClass("on")}else{if(n==="visa"){a.children("li:eq(3)").find("ul>li:eq(2)>a").addClass("on")}else{if(n==="localdeals"){a.children("li:eq(3)").find("ul>li:eq(1)>a").addClass("on")}else{if(n==="insure"){a.children("li:eq(3)").find("ul>li:eq(4)>a").addClass("on")}}}}a.find("li:eq(3)").addClass("head-nav-active")}var H=new RegExp("^/hotel/(?!.*sFrom=mdd).*","ig");if(H.test(u)){a.children("li:eq(4)").addClass("head-nav-active")}var v=new RegExp("^/(wenda|qa|mall|together|group|i|traveller|rudder|paimai|club|postal|school|photo_pk|focus)/(?!.*sFrom=mdd|s.php*).*","i");if(v.test(u)){a.children("li:eq(5)").addClass("head-nav-active")}}});M.define("Storage",function(c,e,b){var l=document;var d={_element:null,_expires:null,_file:document.location.hostname,init:function(){if(!this._element){try{this._element=l.createElement("input");this._element.type="hidden";this._element.addBehavior("#default#userData");l.body.appendChild(this._element);return{setItem:this.setItem,getItem:this.getItem,removeItem:this.removeItem}}catch(m){M.error(m)}}return true},setItem:function(p,q,n){var m=h(n);this._element.expires=m.toUTCString();this._element.load(this._file);var o=a(this._element.getAttribute(p)),r=g(q,+m);this._element.setAttribute(p,r);this._element.save(this._file);i({key:p,newValue:r,oldValie:o,url:window.location.href})},getItem:function(m){this._element.load(this._file);var n=a(this._element.getAttribute(m));return n&&n.value},removeItem:function(m){this._element.load(this._file);this._element.removeAttribute(m);this._element.save(this._file)}};var j={setItem:function(o,p,n){var m=h(n);localStorage.setItem(o,g(p,+m))},getItem:function(m){var o=+new Date(),n=a(localStorage.getItem(m));if(n){if(o>n.timestamp){localStorage.removeItem(m);n=null}else{n=n.value}}return n},removeItem:function(m){localStorage.removeItem(m)}};var f={},k={on:function(n,o){var m=f[n]||(f[n]=[]);m.push(o)},off:function(n,o){var m=f[n];if(!!m){if(!!o){M.forEach(m,function(q,p){if(q==o){m.splice(p,1)}})}else{m=[]}}return this}};M.mix(d,k);M.mix(j,k);if(window.addEventListener){window.addEventListener("storage",i,false)}else{if(window.attachEvent){window.attachEvent("onstorage",i)}}function i(r){if(!r){r=window.event}var m=M.mix({},r),t=r.newValue&&a(r.newValue),n=r.oldValue&&a(r.oldValue),s=+new Date();m.newValue=t&&t.value;if(!!n&&s<n.timestamp){m.oldValue=n.value}else{m.oldValue=null}var q=r.key,p=f[q],o=0;if(!q||!p||0===p.length){return}while(o<p.length){p[o++].call(window,m)}}function h(m){if(Object.prototype.toString.call(m)!="[object Date]"){var n=typeof m==="number"&&m>0?m:86400;m=new Date();m.setTime(+m+n*1000)}return m}function g(n,m){var o={value:n,timestamp:m};return JSON.stringify(o)}function a(m){if(m){try{m=JSON.parse(m);if(!("value" in m)||!("timestamp" in m)){m={value:m,timestamp:+h()}}}catch(n){m={value:m,timestamp:+h()}}}return m}b.exports=window.localStorage?j:d.init()});(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass((c&&c.position)?c.position:a.jGrowl.defaults.position).appendTo("body")}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",a.extend(new a.fn.jGrowl(),{notifications:[],element:null,interval:null}));a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").create(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3000,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ 关闭 ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},afterOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(b,c){var c=a.extend({},this.defaults,c);if(typeof c.speed!=="undefined"){c.openDuration=c.speed;c.closeDuration=c.speed}this.notifications.push({message:b,options:c});c.log.apply(this.element,[this.element,b,c])},render:function(d){var b=this;var c=d.message;var e=d.options;var d=a('<div class="jGrowl-notification '+e.themeState+" ui-corner-all"+((e.group!=undefined&&e.group!="")?" "+e.group:"")+'"><div class="jGrowl-close">'+e.closeTemplate+'</div><div class="jGrowl-header">'+e.header+'</div><div class="jGrowl-message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){a(this).parent().trigger("jGrowl.close")}).parent();a(d).bind("mouseover.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",true)}).bind("mouseout.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",false)}).bind("jGrowl.beforeOpen",function(){if(e.beforeOpen.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.open")}}).bind("jGrowl.open",function(){if(e.open.apply(d,[d,c,e,b.element])!=false){if(e.glue=="after"){a("div.jGrowl-notification:last",b.element).after(d)}else{a("div.jGrowl-notification:first",b.element).before(d)}a(this).animate(e.animateOpen,e.openDuration,e.easing,function(){if(a.browser.msie&&(parseInt(a(this).css("opacity"),10)===1||parseInt(a(this).css("opacity"),10)===0)){this.style.removeAttribute("filter")}a(this).data("jGrowl").created=new Date();a(this).trigger("jGrowl.afterOpen")})}}).bind("jGrowl.afterOpen",function(){e.afterOpen.apply(d,[d,c,e,b.element])}).bind("jGrowl.beforeClose",function(){if(e.beforeClose.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.close")}}).bind("jGrowl.close",function(){a(this).data("jGrowl.pause",true);a(this).animate(e.animateClose,e.closeDuration,e.easing,function(){a(this).remove();var f=e.close.apply(d,[d,c,e,b.element]);if(a.isFunction(f)){f.apply(d,[d,c,e,b.element])}})}).trigger("jGrowl.beforeOpen");if(e.corners!=""&&a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",b.element).size()>1&&a("div.jGrowl-closer",b.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer ui-state-highlight ui-corner-all").addClass(this.defaults.theme).appendTo(b.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().trigger("jGrowl.beforeClose");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+parseInt(a(this).data("jGrowl").life))<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl.pause")==undefined||a(this).data("jGrowl.pause")!=true)){a(this).trigger("jGrowl.beforeClose")}});if(this.notifications.length>0&&(this.defaults.pool==0||a(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift())}if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){a(b).data("jGrowl.instance").update()},parseInt(this.defaults.check));if(a.browser.msie&&parseInt(a.browser.version)<7&&!window.XMLHttpRequest){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)},close:function(){a(this.element).find("div.jGrowl-notification").each(function(){a(this).trigger("jGrowl.beforeClose")})}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("jq-jgrowl",function(){return jQuery})}M.closure(function(e){var q=e("Storage"),b=1000,p=10000,r=40000,d=120000;$(function(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){setTimeout(l,b)}else{setTimeout(j,p)}$("body").delegate(".jGrowl-closer","click",function(t){$.getJSON("/ajax/ajax_msg.php",{a:"closetip"});q.setItem("jgrowl_close_time",+new Date())});M.Event.on("update msg",function(){setTimeout(function(){s();q.setItem("update_msg",+new Date())},1)});q.on("update_msg",function(t){s()});function s(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){n("msgdisplay")}else{n("nologinfeed")}}});function l(){setInterval(function(){M.windowFocused&&n("msgdisplay")},r)}function j(){var t,s=1;M.windowFocused&&n("nologinfeed");t=setInterval(function(){M.windowFocused&&n("nologinfeed");s++;if(s==3){clearInterval(t)}},d)}function n(s){$.get("/ajax/ajax_msg.php?a="+s,function(t){if(t){m(t)}},"json")}function m(s){g();M.Event.fire("get new msg",s);if(s.msg){k()}if(s.tips&&!i()){a(s)}}e("jq-jgrowl");function a(s){var t=s.tips.split(s.split_char);M.forEach(t,function(v,u){if(v){setTimeout(function(){$.jGrowl(v,{header:"新鲜事：",closer:false,life:20000})},2000*u+10)}})}function i(){var t=q.getItem("jgrowl_close_time"),s=+new Date();if(t&&s-t<24*60*60*1000){return true}return false}var c,f=0,h=1000,o=document.title;function k(){g();c=setInterval(function(){f++;document.title=f%2===0?"【　　　】 - "+o:"【新消息】 - "+o},h)}function g(){clearInterval(c);document.title=o}});M.define("FrequencyVerifyControl",function(c,b,d){function a(e){this.container=e.container;this.app=e.app;this.successHandler=$.noop;M.mix(this,e);this.init()}a.prototype={init:function(){this.initData();this.refreshImg();this.verifyCon.delegate("img,._j_change_img","click",$.proxy(function(e){this.refreshImg()},this));this.verifyCon.delegate("._j_fre_confirm","click",$.proxy(function(g){var f=this.verifyText.val();var e=$(g.currentTarget);if(e.hasClass("waiting")){return false}e.addClass("waiting");$.get("/note/ajax_any.php",{sAction:"verifyCode",sCode:f,iApp:this.app},$.proxy(function(h){if(!h.error){if(h.payload&&h.payload.ret==1){this.successHandler(this.target);this.verifyCon.hide()}else{this.verifyText.val("");this.verifyText.focus();this.refreshImg()}this.hideErro()}else{if(h.error.errno==10100){this.showErro("错误次数过多，请稍候尝试")}}e.removeClass("waiting")},this),"json")},this));this.verifyCon.delegate("._j_fre_text","keyup",$.proxy(function(e){if(e.keyCode==13){this.verifyCon.find("._j_fre_confirm").trigger("click")}},this))},showErro:function(e){this.errorCon.html(e);this.errorCon.show()},hideErro:function(){this.errorCon.hide()},initData:function(){this.verifyCon=this.container;this.verifyPo=this.verifyCon.find(".protectedYZM");this.verifyImg=this.verifyCon.find("img");this.verifyText=this.verifyCon.find("._j_fre_text");this.errorCon=this.verifyPo.find(".n-error")},refreshImg:function(){var e="/note/ajax_any.php?sAction=getCode&iApp="+this.app+"&s="+new Date().getTime();this.verifyImg.attr("src",e)}};d.exports=a});M.define("FrequencySystemVerify",function(f,e,g){var b=f("dialog/Dialog"),h=f("dialog/Layer"),d=f("FrequencyVerifyControl");var a='<div class="popYzm" style="z-index:inherit;position: relative;width:350px;height: 250px"><div class="protectedYZM" style="border: none;box-shadow: none;padding:25px 15px;"><p>亲爱的蜂蜂，你操作的速度有点像机器人<br>来证明下自己吧~</p><div class="YZMInput"><input class="_j_fre_text" type="text" placeHolder="验证码"></div><div class="YZMInput"><img src="http://images.mafengwo.net/images/home_new2015/verify.gif" width="150px" height="40px"><label><a href="javascript:void(0);" class="_j_change_img">看不清，换一张</a></label></div><div class="YZMSubmit"><a href="javascript:void(0);" class="_j_fre_confirm" title="确定">确定</a><span class="n-error">错误次数过多，请稍候尝试</span></div></div></div>';function c(i){this.app=i.app;this.init()}c.prototype={init:function(){var i=new b({content:a});if(h.getActive()){i.getLayer().setZIndex(h.getActive().getZIndex()+1)}i.show();var j=i.getPanel().find(".popYzm");new d({container:j,app:this.app,successHandler:$.proxy(function(){M.Event.fire("frequency:system:verify:success");i.close()},this)})}};g.exports=c});M.closure(function(d){var b=d("dialog/Dialog"),c=d("FrequencySystemVerify");window.show_login=a;$.ajaxSetup({dataFilter:function(h,g){try{var j=$.parseJSON(h);if(j&&j.unsafe==1){window.location.href="http://www.mafengwo.cn";return"{}"}if(j&&j.error&&j.error.msg=="login:required"){M.Event.fire("login:required");return"{}"}if(j&&j.resource&&j.resource.onload&&j.resource.onload.length){if(j.resource.onload[0]=='K.fire("login:required");'){M.Event.fire("login:required");return"{}"}}if(j&&j.error){var f=0;var k=0;if(typeof(j.error.errno)!=="undefined"){f=j.error.errno;k=j.error.error}else{if(typeof(j.error.code)!=="undefined"){f=j.error.code;k=j.error.msg}}if(f===10000){M.Event.fire("frequency:verify",k);return"{}"}}}catch(i){}return h}});var e=null;function a(){if($.browser.msie&&parseInt($.browser.version,10)<9){document.location.href=(window.Env&&window.Env.P_HTTP)||"https://passport.mafengwo.cn";return}if(!e){e=new b({content:'<iframe frameborder="no" border="0" scrolling="no" width="580" height="292" allowtransparency="true"></iframe>',background:"#aaa",bgOpacity:0.6,reposition:true})}e.show();if(!e.getPanel().find("iframe").attr("src")){M.Event(e).once("aftershow",function(){var f=window.Env.P_HTTP||"https://passport.mafengwo.cn";e.getPanel().find("iframe").attr("src",f+"/login-popup.html")})}}M.Event.on("login:required",a);M.Event.on("frequency:verify",function(f){new c({app:f})});if(M.Event.isFired("login:required")){a()}});M.define("ScrollObserver",function(e,g,c){var h=0,f={},a=false,b,d=true;g.addObserver=function(k){var j="ScrollObserver_"+h;h++;f[j]=k;d=false;return j};g.removeObserver=function(j){delete f[j];if(M.isEmpty(f)){d=true}};function i(){for(var j in f){if(f.hasOwnProperty(j)){f[j]()}}}$(window).scroll(function(){if(d){return}if(!a){b=setInterval(function(){if(a){a=false;clearTimeout(b);i()}},50)}a=true});return g});M.define("QRCode",function(b,a,c){c.exports={gen:function(e,d){var d={text:e,size:d.size||200,eclevel:d.evlevel||"H",logo:d.logo||"",__stk__:window.Env.CSTK};return"http://"+window.Env.WWW_HOST+"/qrcode.php?"+$.param(d)}}});M.closure(function(b){var n=b("ScrollObserver"),d=window.Env||{},h=$("#_j_mfwtoolbar"),j=h.height(),a=$(window).height(),m=$(document).height(),i=$("#footer"),g=i.outerHeight();$("body").css("position","relative");$(window).resize(function(){a=$(window).height();m=$(document).height()});setInterval(function(){var o=$(document).height();if(o!=m){m=o;$(window).trigger("scroll")}},2000);if(!d.hideToolbar){if(d.showToolbarQrcode){var e=d.qrcodeURL||location.href,f=b("QRCode").gen(e,{size:105});h.children(".toolbar-item-code").show().children("._j_code").prepend('<img src="'+f+'">')}else{h.children(".toolbar-item-code").remove()}if(!d.showToolbarDownArrow){h.children(".toolbar-item-down").remove()}else{h.children(".toolbar-item-down").show()}h.show();c();n.addObserver(c);h.on("click","._j_gotop",k);h.on("click","._j_gobottom",l)}function c(){var o=$(window).scrollTop();if(o>500){h.children(".toolbar-item-top").show()}else{h.children(".toolbar-item-top").hide()}if(i.length){if(o+a>i.offset().top){h.css({position:"absolute",bottom:g+20})}else{h.css({position:"",bottom:""})}}}function k(){$("html, body").animate({scrollTop:0},500,function(){M.Event.fire("scroll to top")})}function l(){$("html, body").animate({scrollTop:m-a},500,function(){M.Event.fire("scroll to bottom")})}});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-7892704-1"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();(function(){var a=document.createElement("script"),b=window.Env&&window.Env.CNZZID||30065558;a.type="text/javascript";a.async=true;a.charset="utf-8";a.src=document.location.protocol+"//w.cnzz.com/c.php?id="+b+"&async=1";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)})();